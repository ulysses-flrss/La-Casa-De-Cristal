USE master;
GO

CREATE DATABASE Analisis
GO

USE Analisis
GO

CREATE TABLE MAQUINA
(COD_MAQUINA char(6) PRIMARY KEY NOT NULL,
DESCRIPCION varchar(100) NOT NULL,
MARCA varchar(50) NOT NULL,
MODELO varchar(50) NOT NULL,
FECHAINGRESO date NOT NULL);

CREATE TABLE EMPLEADO
(ID char(10) PRIMARY KEY NOT NULL,
NOMBRES VARCHAR(50) NOT NULL,
APELLIDOS VARCHAR(50) NOT NULL,
EDAD int NOT NULL,
FECHAINICIO date NOT NULL
)

CREATE TABLE BITACORA(
CORRELATIVO INT IDENTITY(1,1) NOT NULL, 
ID CHAR(10) NOT NULL,
COD_MAQUINA CHAR (6) NOT NULL,
TIEMPOUSO INT NOT NULL,
LUGAR VARCHAR (50) NOT NULL,
CONSTRAINT FK_ID FOREIGN KEY (ID) REFERENCES  EMPLEADO(ID),
CONSTRAINT KK_COD FOREIGN KEY (COD_MAQUINA) REFERENCES MAQUINA(COD_MAQUINA));

INSERT INTO MAQUINA VALUES
('M00001', 'TALADORA DE ELEMENTO VARIOS', 'CATERPILLAR', 'EVO2000', '2006-01-31'),
('M00002', 'APLANADORA DE SUELOS Y OTROS', 'CATERPILLAR', 'FLU5000', '2006-01-31'),
('M00003','PULVERIZADORA DE ELEMENTOS', 'CATERPILLAR', 'ASD2001', '2006-01-31'),
('M00004','CONCRETERA', 'MG', 'EDS', '2006-05-31'),
('M00005', 'MAQUINA ESPECIAL PARA PORYECTO 10', 'MG', 'SFD', '2006-05-31'),
('M00006', 'MAQUINA ESPECIAL PARA PROYECTO 30', 'MG', 'SFD', '2006-05-31');

INSERT INTO EMPLEADO VALUES 
('01234567-8', 'CARLOS FIDEL', 'ARGUETA MIRANDA', 45, '2006-08-21'),
('12345678-9', 'JUAN FRANCISCO' , 'VILLALTA ALVARADO', 32, '2010-02-27'),
('78901234-5', 'RAUL ALEJANDRO', 'PONCIO VALLADARES', 32, '2010-02-27'),
('89012345-6', 'MIGUEL EDUARDO', 'MORALES CLAROS', 26, '2010-08-21'),
('90123456-7', 'FABRICIO DAVID', 'ALAS FLORES', 30, '2008-12-01');

INSERT INTO BITACORA (ID, COD_MAQUINA, TIEMPOUSO, LUGAR) VALUES 
( '12345678-9', 'M00001', 250, 'SANTIAGO NONUALCO'),
( '01234567-8', 'M00002', 300, 'SANTIAGO NONUALCO'),
( '90123456-7', 'M00003', 500, 'ALEGRIA, USUALUTAN'),
( '89012345-6', 'M00004', 300, 'ALEGRIA, USULUTAN'),
('90123456-7', 'M00005', 250, 'SANTIAGO NONUALCO'),
( '01234567-8', 'M00002', 125, 'SANTIAGO NONUALCO'),
('12345678-9', 'M00003', 375, 'ALEGRIA, USULUTAN'),
('12345678-9', 'M00004', 200, 'ALEGRIA, USULUTAN');



-- a. Mostrar los empleados que hayan o estén haciendo uso de unamaquina
--i. Campos a mostrar: Nombres del empleado, Marca, Modelo y Descripción de la maquina

SELECT CONCAT(e.NOMBRES,' ' , e.APELLIDOS)  AS 'Nombre del empleado', m.MARCA, m.MODELO, m.DESCRIPCION
FROM EMPLEADO e
JOIN BITACORA b ON e.ID = b.ID
JOIN MAQUINA m ON b.COD_MAQUINA = m.COD_MAQUINA;

--b. Mostrar los empleados que todavía no tienen asignada una maquina
--i. Campos a mostrar: Nombres y Apellidos del empleado y Código de la maquina

SELECT e.Nombres + ' ' + e.Apellidos AS 'Nombre del empleado', m.COD_MAQUINA AS 'Código de la máquina'
FROM EMPLEADO e
LEFT JOIN BITACORA b ON e.ID = b.ID
LEFT JOIN MAQUINA m ON b.COD_MAQUINA = m.COD_MAQUINA
WHERE b.COD_MAQUINA IS NULL;

-- c. Mostrar las maquinas que no están asignadas a un proyecto
--i. Campos a mostrar: Nombres y Apellidos del empleado y Descripción de lamaquina

SELECT e.Nombres + ' ' + e.Apellidos AS 'Nombre del empleado', m.Descripcion AS 'Descripción de la máquina'
FROM MAQUINA m
LEFT JOIN BITACORA b ON m.COD_MAQUINA = b.COD_MAQUINA
LEFT JOIN EMPLEADO e ON b.ID = e.ID
WHERE b.LUGAR IS NULL;
